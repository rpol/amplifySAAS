{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/src/lib/auth.ts"],"sourcesContent":["export const DEFAULT_AUTH_REDIRECT = \"/amplify/default\";\n\nconst betterAuthBaseUrlInput =\n  process.env.NEXT_PUBLIC_BETTER_AUTH_URL ??\n  process.env.BETTER_AUTH_API_URL ??\n  undefined;\n\nconst betterAuthBasePathInput =\n  process.env.NEXT_PUBLIC_BETTER_AUTH_PATH ??\n  process.env.BETTER_AUTH_API_PATH ??\n  \"/api/auth\";\n\nfunction toAbsoluteUrl(value?: string): string | undefined {\n  if (!value) return undefined;\n  try {\n    return new URL(value).toString().replace(/\\/+$/, \"\");\n  } catch (error) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.warn(\n        `[better-auth] Ignoring invalid Better Auth base URL. Provide an absolute URL instead. Received: ${value}`,\n        error,\n      );\n    }\n    return undefined;\n  }\n}\n\nfunction normalizePath(pathValue: string): string {\n  const trimmed = pathValue.trim();\n  if (!trimmed) return \"/api/auth\";\n  return trimmed.startsWith(\"/\") ? trimmed : `/${trimmed}`;\n}\n\nexport const BETTER_AUTH_BASE_URL = toAbsoluteUrl(betterAuthBaseUrlInput);\n\nexport const BETTER_AUTH_BASE_PATH = normalizePath(betterAuthBasePathInput);\n\nexport type { AuthResponse } from \"@amplify/types\";\n\nexport function resolveRedirectPath(path?: string | null): string {\n  if (!path) return DEFAULT_AUTH_REDIRECT;\n  if (!path.startsWith(\"/\")) return DEFAULT_AUTH_REDIRECT;\n  if (path.startsWith(\"//\")) return DEFAULT_AUTH_REDIRECT;\n  if (path.startsWith(\"/auth\")) return DEFAULT_AUTH_REDIRECT;\n  return path;\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAO,MAAM,wBAAwB;AAErC,MAAM,yBACJ,QAAQ,GAAG,CAAC,2BAA2B,IACvC,QAAQ,GAAG,CAAC,mBAAmB,IAC/B;AAEF,MAAM,0BACJ,QAAQ,GAAG,CAAC,4BAA4B,IACxC,QAAQ,GAAG,CAAC,oBAAoB,IAChC;AAEF,SAAS,cAAc,KAAc;IACnC,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,IAAI,IAAI,OAAO,QAAQ,GAAG,OAAO,CAAC,QAAQ;IACnD,EAAE,OAAO,OAAO;QACd,wCAA2C;YACzC,QAAQ,IAAI,CACV,CAAC,gGAAgG,EAAE,OAAO,EAC1G;QAEJ;QACA,OAAO;IACT;AACF;AAEA,SAAS,cAAc,SAAiB;IACtC,MAAM,UAAU,UAAU,IAAI;IAC9B,IAAI,CAAC,SAAS,OAAO;IACrB,OAAO,QAAQ,UAAU,CAAC,OAAO,UAAU,CAAC,CAAC,EAAE,SAAS;AAC1D;AAEO,MAAM,uBAAuB,cAAc;AAE3C,MAAM,wBAAwB,cAAc;AAI5C,SAAS,oBAAoB,IAAoB;IACtD,IAAI,CAAC,MAAM,OAAO;IAClB,IAAI,CAAC,KAAK,UAAU,CAAC,MAAM,OAAO;IAClC,IAAI,KAAK,UAAU,CAAC,OAAO,OAAO;IAClC,IAAI,KAAK,UAAU,CAAC,UAAU,OAAO;IACrC,OAAO;AACT"}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/src/middleware.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\";\n\nimport {\n  BETTER_AUTH_BASE_PATH,\n  BETTER_AUTH_BASE_URL,\n  DEFAULT_AUTH_REDIRECT,\n} from \"@/lib/auth\";\n\nconst PUBLIC_PATHS = [\"/auth\", \"/unauthorized\"];\nconst LOGIN_PATH = \"/auth/v2/login\";\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const isAuthRoute = pathname.startsWith(\"/auth\");\n  const isPublic = isPublicPath(pathname);\n\n  if (pathname.startsWith(\"/api\")) {\n    return NextResponse.next();\n  }\n\n  const sessionState = await validateSession(request);\n\n  if (!sessionState.valid) {\n    return isPublic\n      ? NextResponse.next()\n      : redirectToLogin(request, sessionState.shouldClear);\n  }\n\n  if (isAuthRoute) {\n    const redirectUrl = new URL(DEFAULT_AUTH_REDIRECT, request.url);\n    const response = NextResponse.redirect(redirectUrl);\n    response.headers.set(\"Cache-Control\", \"no-store\");\n    return response;\n  }\n\n  return NextResponse.next();\n}\n\nasync function validateSession(\n  request: NextRequest,\n): Promise<{ valid: boolean; shouldClear: boolean }> {\n  const cookies = request.headers.get(\"cookie\");\n\n  if (!cookies) {\n    return { valid: false, shouldClear: false };\n  }\n\n  const origin = BETTER_AUTH_BASE_URL ?? request.nextUrl.origin;\n  const path = `${BETTER_AUTH_BASE_PATH.replace(/\\/$/, \"\")}/get-session`;\n  const endpoint = new URL(path, origin);\n\n  try {\n    const response = await fetch(endpoint, {\n      method: \"GET\",\n      headers: {\n        cookie: cookies,\n      },\n      cache: \"no-store\",\n    });\n\n    if (!response.ok) {\n      const shouldClear = response.status === 401;\n      return { valid: false, shouldClear };\n    }\n\n    const payload = (await response.json().catch(() => null)) as {\n      session?: { token?: string } | null;\n    } | null;\n\n    return { valid: Boolean(payload?.session?.token), shouldClear: false };\n  } catch (error) {\n    console.error(\"Failed to validate session\", error);\n    return { valid: false, shouldClear: false };\n  }\n}\n\nfunction isPublicPath(pathname: string) {\n  return PUBLIC_PATHS.some(\n    (path) => pathname === path || pathname.startsWith(`${path}/`),\n  );\n}\n\nfunction redirectToLogin(request: NextRequest, shouldClearCookie = false) {\n  const redirectUrl = new URL(LOGIN_PATH, request.url);\n  const currentPath = `${request.nextUrl.pathname}${request.nextUrl.search}`;\n  if (request.nextUrl.pathname && request.nextUrl.pathname !== LOGIN_PATH) {\n    redirectUrl.searchParams.set(\"redirect\", currentPath);\n  }\n\n  const response = NextResponse.redirect(redirectUrl);\n  response.headers.set(\"Cache-Control\", \"no-store\");\n\n  if (shouldClearCookie) {\n    for (const name of BETTER_AUTH_COOKIE_CANDIDATES) {\n      response.cookies.delete(name);\n    }\n  }\n\n  return response;\n}\n\nconst BETTER_AUTH_COOKIE_CANDIDATES = [\n  \"better-auth.session_token\",\n  \"__Secure-better-auth.session_token\",\n  \"better-auth.session_data\",\n  \"__Secure-better-auth.session_data\",\n  \"better-auth.dont_remember\",\n  \"__Secure-better-auth.dont_remember\",\n];\n\nexport const config = {\n  matcher: [\"/((?!_next/static|_next/image|favicon.ico|assets).*)\"],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAMA,MAAM,eAAe;IAAC;IAAS;CAAgB;AAC/C,MAAM,aAAa;AAEZ,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,cAAc,SAAS,UAAU,CAAC;IACxC,MAAM,WAAW,aAAa;IAE9B,IAAI,SAAS,UAAU,CAAC,SAAS;QAC/B,OAAO,qZAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,eAAe,MAAM,gBAAgB;IAE3C,IAAI,CAAC,aAAa,KAAK,EAAE;QACvB,OAAO,WACH,qZAAY,CAAC,IAAI,KACjB,gBAAgB,SAAS,aAAa,WAAW;IACvD;IAEA,IAAI,aAAa;QACf,MAAM,cAAc,IAAI,IAAI,kKAAqB,EAAE,QAAQ,GAAG;QAC9D,MAAM,WAAW,qZAAY,CAAC,QAAQ,CAAC;QACvC,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB;QACtC,OAAO;IACT;IAEA,OAAO,qZAAY,CAAC,IAAI;AAC1B;AAEA,eAAe,gBACb,OAAoB;IAEpB,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEpC,IAAI,CAAC,SAAS;QACZ,OAAO;YAAE,OAAO;YAAO,aAAa;QAAM;IAC5C;IAEA,MAAM,SAAS,iKAAoB,IAAI,QAAQ,OAAO,CAAC,MAAM;IAC7D,MAAM,OAAO,GAAG,kKAAqB,CAAC,OAAO,CAAC,OAAO,IAAI,YAAY,CAAC;IACtE,MAAM,WAAW,IAAI,IAAI,MAAM;IAE/B,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,UAAU;YACrC,QAAQ;YACR,SAAS;gBACP,QAAQ;YACV;YACA,OAAO;QACT;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,cAAc,SAAS,MAAM,KAAK;YACxC,OAAO;gBAAE,OAAO;gBAAO;YAAY;QACrC;QAEA,MAAM,UAAW,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM;QAInD,OAAO;YAAE,OAAO,QAAQ,SAAS,SAAS;YAAQ,aAAa;QAAM;IACvE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;YAAE,OAAO;YAAO,aAAa;QAAM;IAC5C;AACF;AAEA,SAAS,aAAa,QAAgB;IACpC,OAAO,aAAa,IAAI,CACtB,CAAC,OAAS,aAAa,QAAQ,SAAS,UAAU,CAAC,GAAG,KAAK,CAAC,CAAC;AAEjE;AAEA,SAAS,gBAAgB,OAAoB,EAAE,oBAAoB,KAAK;IACtE,MAAM,cAAc,IAAI,IAAI,YAAY,QAAQ,GAAG;IACnD,MAAM,cAAc,GAAG,QAAQ,OAAO,CAAC,QAAQ,GAAG,QAAQ,OAAO,CAAC,MAAM,EAAE;IAC1E,IAAI,QAAQ,OAAO,CAAC,QAAQ,IAAI,QAAQ,OAAO,CAAC,QAAQ,KAAK,YAAY;QACvE,YAAY,YAAY,CAAC,GAAG,CAAC,YAAY;IAC3C;IAEA,MAAM,WAAW,qZAAY,CAAC,QAAQ,CAAC;IACvC,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB;IAEtC,IAAI,mBAAmB;QACrB,KAAK,MAAM,QAAQ,8BAA+B;YAChD,SAAS,OAAO,CAAC,MAAM,CAAC;QAC1B;IACF;IAEA,OAAO;AACT;AAEA,MAAM,gCAAgC;IACpC;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,SAAS;IACpB,SAAS;QAAC;KAAuD;AACnE"}}]
}